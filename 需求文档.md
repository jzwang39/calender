# 仓库预约管理系统需求文档

## 1. 系统概述

本系统是一个基于Web的仓库预约管理系统，旨在帮助仓库管理员和运营人员高效管理仓库使用时段，同时为客户提供便捷的预约服务。

## 2. 技术栈

- **后端框架**：Node.js + Express.js
- **前端技术**：EJS模板引擎 + HTML/CSS/JavaScript
- **数据库**：SQLite
- **认证机制**：Session-based认证
- **密码加密**：bcrypt
- **依赖管理**：npm

## 3. 系统架构

### 3.1 目录结构

```
calender/
├── app.js                    # 应用入口文件
├── config/
│   └── database.js           # 数据库配置和初始化
├── models/                   # 数据模型
│   ├── user.js               # 用户模型
│   ├── reservation.js        # 预约模型
│   └── closedSlot.js         # 关闭时段模型
├── routes/                   # 路由定义
│   ├── auth.js               # 认证路由
│   ├── admin.js              # 管理员路由
│   ├── operator.js           # 运营人员路由
│   └── client.js             # 客户路由
├── views/                    # 视图模板
│   ├── login.ejs             # 登录页面
│   ├── change-password.ejs   # 修改密码页面
│   ├── admin/                # 管理员视图
│   │   ├── dashboard.ejs     # 管理员仪表盘
│   │   └── closed-slots.ejs  # 关闭时段管理
│   ├── operator/             # 运营人员视图
│   │   ├── dashboard.ejs     # 运营仪表盘
│   │   └── clients.ejs       # 客户管理
│   └── client/               # 客户视图
│       └── reservation.ejs   # 预约页面
└── public/                   # 静态资源
    ├── css/                  # 样式文件
    ├── js/                   # JavaScript文件
    └── images/               # 图片资源
```

### 3.2 数据库设计

#### 用户表（users）

| 字段名   | 类型    | 约束             | 描述         |
|---------|---------|-----------------|-------------|
| id      | INTEGER | PRIMARY KEY AUTOINCREMENT | 用户ID   |
| username| TEXT    | UNIQUE NOT NULL | 用户名       |
| password| TEXT    | NOT NULL        | 密码（哈希存储）| 
| role    | TEXT    | NOT NULL        | 角色（admin/operator/client）| 
| name    | TEXT    | NOT NULL        | 真实姓名     |
| contact | TEXT    |                 | 联系方式     |

#### 预约表（reservations）

| 字段名       | 类型     | 约束             | 描述         |
|-------------|---------|-----------------|-------------|
| id          | INTEGER | PRIMARY KEY AUTOINCREMENT | 预约ID   |
| user_id     | INTEGER | NOT NULL        | 预约用户ID   |
| date        | TEXT    | NOT NULL        | 预约日期     |
| time_slot   | TEXT    | NOT NULL        | 预约时段     |
| status      | TEXT    |                 | 预约状态（active/cancelled）| 
| container_number | TEXT |                 | 集装箱号    |
| packing_list| TEXT    |                 | 装箱单       |
| created_at  | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

#### 关闭时段表（closed_slots）

| 字段名       | 类型     | 约束             | 描述         |
|-------------|---------|-----------------|-------------|
| id          | INTEGER | PRIMARY KEY AUTOINCREMENT | ID     |
| date        | TEXT    | NOT NULL        | 日期         |
| time_slot   | TEXT    | NOT NULL        | 时段         |
| reason      | TEXT    |                 | 关闭原因     |
| created_by  | INTEGER | NOT NULL        | 创建人ID     |
| created_at  | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

## 4. 功能需求

### 4.1 认证功能

#### 登录
- 用户通过用户名和密码登录系统
- 系统验证用户身份和权限
- 根据用户角色重定向到相应的仪表盘

#### 退出登录
- 用户可以安全退出系统
- 系统清除用户会话信息

#### 修改密码
- 用户可以修改自己的密码
- 系统验证原密码正确性
- 新密码需要确认
- 密码修改后使用bcrypt加密存储

### 4.2 预约管理功能

#### 创建预约
- 客户可以选择日期和时段进行预约
- 系统检查时段可用性（是否已被预约或关闭）
- 周六和周日不可预约
- 预约成功后发送确认信息

#### 查看预约
- 客户可以查看自己的预约历史
- 运营人员可以查看所有客户的预约
- 管理员可以查看所有预约

#### 取消预约
- 客户可以取消自己的预约
- 运营人员可以取消任何预约
- 管理员可以取消任何预约

### 4.3 时段管理功能

#### 设置关闭时段
- 管理员可以设置特定日期和时段为不可预约
- 需要填写关闭原因

#### 查看关闭时段
- 管理员和运营人员可以查看所有关闭时段
- 可以按日期筛选

#### 取消关闭时段
- 管理员可以取消已设置的关闭时段

### 4.4 用户管理功能

#### 查看用户列表
- 管理员可以查看所有用户
- 运营人员可以查看所有客户
- 可以按角色筛选

## 5. 角色与权限

### 5.1 仓库管理员（admin）
- 登录系统
- 修改密码
- 查看所有预约
- 设置和取消关闭时段
- 查看所有用户

### 5.2 运营人员（operator）
- 登录系统
- 修改密码
- 查看所有客户的预约
- 查看所有关闭时段
- 查看所有客户信息

### 5.3 客户（client）
- 登录系统
- 修改密码
- 创建预约
- 查看和取消自己的预约

## 6. 业务规则

1. 预约时间只能是工作日（周一至周五）
2. 每个时段只能被一个客户预约
3. 管理员可以关闭任何时段，使其不可预约
4. 密码必须使用bcrypt加密存储
5. 用户只能查看和修改自己的个人信息

## 7. 界面设计

### 7.1 登录页面
- 用户名输入框
- 密码输入框
- 登录按钮
- 错误提示信息

### 7.2 管理员仪表盘
- 系统概览
- 预约统计
- 快捷操作按钮
- 导航菜单

### 7.3 客户预约页面
- 日历视图选择日期
- 时段列表选择时段
- 预约表单（集装箱号、装箱单等）
- 预约历史列表

### 7.4 关闭时段管理页面
- 日期选择器
- 时段选择器
- 关闭原因输入框
- 关闭时段列表

## 8. 系统部署与维护

### 8.1 环境要求
- Node.js v14.0+ 
- npm v6.0+ 
- SQLite v3.0+ 

### 8.2 安装步骤
1. 克隆代码仓库
2. 安装依赖：`npm install`
3. 配置环境变量（可选）
4. 启动服务器：`node app.js`

### 8.3 维护
- 定期备份数据库文件
- 监控系统日志
- 及时更新依赖包

## 9. 测试数据

系统初始化时会自动创建以下测试用户：

| 用户名    | 密码      | 角色       | 姓名         |
|----------|----------|-----------|-------------|
| admin    | 123456   | admin     | 仓库管理员   |
| operator | 123456   | operator  | 运营人员     |
| client1  | 123456   | client    | 客户1        |
| client2  | 123456   | client    | 客户2        |

## 10. 系统改进方向

1. 添加邮件通知功能
2. 实现更复杂的预约规则（如批量预约）
3. 增加数据统计和报表功能
4. 支持多仓库管理
5. 实现移动应用版本
6. 增加文件上传功能（如装箱单上传）

---

**文档版本**：1.0
**最后更新**：2025-06-01
**文档作者**：系统开发团队